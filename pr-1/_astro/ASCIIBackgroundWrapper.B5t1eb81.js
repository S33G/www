import{j as W}from"./jsx-runtime.D_zvdyIk.js";import{r as g}from"./index.WFquGv8Z.js";import{l as q,C as O}from"./preferences.DZPTYPjL.js";const R={minimal:" .:#",standard:" .:-=+*#%@",detailed:" .'`^\",:;Il!i><~+_-?][}{1)(|\\/tfjrxnuvczXYUJCLQ0OZmwqpdbkhao*#MW&8%B@$",blocks:" ░▒▓█",matrix:"ﾊﾐﾋｰｳｼﾅﾓﾆｻﾜﾂｵﾘｱﾎﾃﾏｹﾒｴｶｷﾑﾕﾗｾﾈｽﾀﾇﾍ012345789Z"},L={low:{cellSize:20,effectsEnabled:!1,maxParticles:25,updateInterval:16},medium:{cellSize:16,effectsEnabled:!0,maxParticles:50,updateInterval:16},high:{cellSize:12,effectsEnabled:!0,maxParticles:100,updateInterval:16},ultra:{cellSize:10,effectsEnabled:!0,maxParticles:200,updateInterval:16}};class V{frameCount=0;lastTime=performance.now();fps=60;frameTimeHistory=[];historySize=30;currentQuality="medium";qualityLocked=!1;tick(){const t=performance.now(),e=t-this.lastTime;this.lastTime=t,this.frameCount++,this.frameTimeHistory.push(e),this.frameTimeHistory.length>this.historySize&&this.frameTimeHistory.shift();const s=this.frameTimeHistory.reduce((n,i)=>n+i,0)/this.frameTimeHistory.length;return this.fps=1e3/s,{fps:Math.round(this.fps),frameTime:Math.round(s*100)/100,quality:this.currentQuality}}checkAndAdapt(){return this.qualityLocked||this.frameTimeHistory.length<this.historySize?this.currentQuality:(this.fps<30&&this.currentQuality!=="low"?this.currentQuality=this.decreaseQuality(this.currentQuality):this.fps>58&&this.currentQuality!=="ultra"&&(this.currentQuality=this.increaseQuality(this.currentQuality)),this.currentQuality)}lockQuality(t){this.currentQuality=t,this.qualityLocked=!0}unlockQuality(){this.qualityLocked=!1}decreaseQuality(t){const e=["low","medium","high","ultra"],s=e.indexOf(t);return e[Math.max(0,s-1)]}increaseQuality(t){const e=["low","medium","high","ultra"],s=e.indexOf(t);return e[Math.min(e.length-1,s+1)]}getSettings(){return L[this.currentQuality]}reset(){this.frameCount=0,this.frameTimeHistory=[],this.currentQuality="medium",this.qualityLocked=!1}}function tt(){return typeof window>"u"?!1:window.matchMedia("(prefers-reduced-motion: reduce)").matches}function $(){return typeof document>"u"?!0:!document.hidden}function et(){if(typeof navigator>"u")return!1;const y=navigator.userAgent.toLowerCase();return/android|iphone|ipad|ipod|mobile|tablet/i.test(y)}function j(){return tt()||et()?"low":"medium"}class N{container;canvas;ctx;charSet;fontSize;cellWidth;cellHeight;cols;rows;color;backgroundColor;effect;speed;intensity;time=0;animationId=null;performanceMonitor;mouseX=0;mouseY=0;isRunning=!1;lastFrameTime=0;frameInterval=33;currentQuality="medium";lastMetrics={fps:0,frameTime:0,quality:"medium"};targetIntensity=.6;intensityTweenStart=.6;intensityTweenProgress=1;intensityTweenDuration=500;intensityTweenStartTime=0;isTransitioning=!1;transitionProgress=0;transitionDuration=1e3;oldEffect=null;transitionStartTime=0;matrixColumns=[];explosions=[];columnRecoveryOffsets=[];mouseTrail=[];lastMouseUpdate=0;mouseThrottleInterval=33;charAtlas=null;charAtlasCtx=null;atlasCharWidth=0;atlasCharHeight=0;currentAtlasColor="";matrixAtlas=null;matrixAtlasCtx=null;introActive=!0;introStartTime=0;introDuration=1e3;introColumnDelays=[];triggerExplosion(t,e){this.columnRecoveryOffsets=[];for(let s=0;s<this.cols;s++)this.columnRecoveryOffsets[s]=Math.random()*.15;this.explosions.push({x:t,y:e,radius:0,startTime:Date.now(),phase:"expanding",recoveryProgress:0})}updateExplosions(){const t=Date.now();this.explosions=this.explosions.filter(e=>{const s=t-e.startTime;return s<1500?(e.phase="expanding",e.radius=s*.002*Math.max(1,this.speed),!0):s<2500?(e.phase="holding",e.radius=1500*.002*Math.max(1,this.speed),!0):s<5500?(e.phase="recovering",e.recoveryProgress=(s-2500)/3e3,!0):!1})}applyExplosionEffect(t,e,s){let n=t*this.cellWidth,i=e*this.cellHeight,a=s;const h=t/this.cols,r=e/this.rows;for(const o of this.explosions){const d=this.cols/this.rows,c=(h-o.x)*d,f=r-o.y,p=Math.sqrt(c*c+f*f),x=o.radius,u=.2;if(o.phase==="expanding"||o.phase==="holding")if(p<x&&p>x-u){const l=1-(x-p)/u,m=l*50*this.intensity;n+=c*m,i+=f*m,a=Math.min(1,a+l*.5)}else p<=x-u&&(a=0);else if(o.phase==="recovering"){const l=this.columnRecoveryOffsets[t]||0,m=o.recoveryProgress*1.3-l,w=Math.sin(t*.3+o.recoveryProgress*10)*.02,C=m+w,M=r-C;if(M>.15)a=0;else if(M>0){const v=1-M/.15;a=s*v*v}else if(M>-.08){const v=1+(1+M/.08)*.6;a=Math.min(1,s*v),i-=(1+M/.08)*3}}}return this.introActive&&(a*=this.getIntroAlpha(t,e)),{x:n,y:i,alpha:a}}getIntroAlpha(t,e){if(!this.introActive)return 1;const n=performance.now()-this.introStartTime,i=Math.min(n/this.introDuration,1);if(i>=1)return this.introActive=!1,1;const h=(this.introColumnDelays[t]||0)*.5,r=Math.max(0,(i-h)/(1-h));if(r<=0)return 0;const o=e/this.rows,d=r*1.3,c=o-d;if(c>.2)return 0;if(c>0){const f=1-c/.2;return f*f*(3-2*f)}else return c>-.1,1}constructor(t){this.container=t.container,this.charSet=R[t.charSet||"standard"],this.fontSize=t.fontSize||14,this.color=t.color||"#00ff00",this.backgroundColor=t.backgroundColor||"#0a0a0a",this.effect=t.effect||"wave",this.speed=t.speed||1,this.intensity=t.intensity||.6,this.performanceMonitor=new V,this.currentQuality=j(),this.frameInterval=L[this.currentQuality].updateInterval,this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.style.top="0",this.canvas.style.left="0",this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.zIndex="-1",this.container.appendChild(this.canvas);const e=this.canvas.getContext("2d");if(!e)throw new Error("Failed to get 2D context");this.ctx=e,this.cellWidth=this.fontSize*.6,this.cellHeight=this.fontSize,this.cols=0,this.rows=0,this.resize(),this.setupEventListeners()}setupEventListeners(){window.addEventListener("resize",this.handleResize),document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("visibilitychange",this.handleVisibilityChange)}handleResize=()=>{this.resize()};handleMouseMove=t=>{const e=performance.now();if(e-this.lastMouseUpdate<this.mouseThrottleInterval)return;this.lastMouseUpdate=e;const s=this.canvas.getBoundingClientRect();this.mouseX=(t.clientX-s.left)/s.width,this.mouseY=(t.clientY-s.top)/s.height};handleVisibilityChange=()=>{$()&&this.isRunning?this.start():this.pause()};resize(){const t=this.container.getBoundingClientRect(),e=window.devicePixelRatio||1;this.canvas.width=t.width*e,this.canvas.height=t.height*e,this.ctx.scale(e,e),this.cols=Math.floor(t.width/this.cellWidth),this.rows=Math.floor(t.height/this.cellHeight),this.initIntroDelays(),this.initMatrixColumns()}initIntroDelays(){this.introColumnDelays=[];for(let t=0;t<this.cols;t++){const e=this.cols/2,s=Math.abs(t-e)/e;this.introColumnDelays[t]=s*.4+Math.random()*.3}}initMatrixColumns(){this.matrixColumns=[];for(let t=0;t<this.cols;t++)this.matrixColumns.push({y:Math.random()*this.rows*-1,speed:Math.random()*.5+.3,chars:this.generateRandomChars(Math.floor(Math.random()*15)+5)})}generateRandomChars(t){const e=[],s=R.matrix;for(let n=0;n<t;n++)e.push(s[Math.floor(Math.random()*s.length)]);return e}buildCharAtlas(t,e){if(this.charAtlas&&this.currentAtlasColor===t&&this.atlasCharHeight===e)return;this.currentAtlasColor=t,this.atlasCharWidth=Math.ceil(e*.6),this.atlasCharHeight=e;const s=this.charSet.length,n=s*this.atlasCharWidth;if(this.charAtlas=new OffscreenCanvas(n,this.atlasCharHeight),this.charAtlasCtx=this.charAtlas.getContext("2d"),this.charAtlasCtx){this.charAtlasCtx.font=`${e}px monospace`,this.charAtlasCtx.textBaseline="top",this.charAtlasCtx.fillStyle=t;for(let h=0;h<s;h++)this.charAtlasCtx.fillText(this.charSet[h],h*this.atlasCharWidth,0)}const i=R.matrix,a=i.length*this.atlasCharWidth;if(this.matrixAtlas=new OffscreenCanvas(a,this.atlasCharHeight),this.matrixAtlasCtx=this.matrixAtlas.getContext("2d"),this.matrixAtlasCtx){this.matrixAtlasCtx.font=`${e}px monospace`,this.matrixAtlasCtx.textBaseline="top",this.matrixAtlasCtx.fillStyle=t;for(let h=0;h<i.length;h++)this.matrixAtlasCtx.fillText(i[h],h*this.atlasCharWidth,0)}}drawCharFromAtlas(t,e,s,n,i=!1){const a=i?this.matrixAtlas:this.charAtlas,h=i?R.matrix:this.charSet;if(!a||n<=.01)return;const r=h.indexOf(t);if(r===-1){this.ctx.globalAlpha=n,this.ctx.fillText(t,e,s);return}const o=r*this.atlasCharWidth;this.ctx.globalAlpha=n,this.ctx.drawImage(a,o,0,this.atlasCharWidth,this.atlasCharHeight,e,s,this.atlasCharWidth,this.atlasCharHeight)}start(){this.isRunning=!0,this.introActive=!0,this.introStartTime=performance.now(),this.animate()}skipIntro(){this.introActive=!1}renderStaticFrame(){this.renderStatic()}pause(){this.animationId!==null&&(cancelAnimationFrame(this.animationId),this.animationId=null)}stop(){this.isRunning=!1,this.pause()}animate=()=>{if(!this.isRunning)return;this.animationId=requestAnimationFrame(this.animate);const t=performance.now(),e=t-this.lastFrameTime;if(e<this.frameInterval)return;this.lastFrameTime=t-e%this.frameInterval,this.lastMetrics=this.performanceMonitor.tick();const s=this.performanceMonitor.checkAndAdapt();s!==this.currentQuality&&(this.currentQuality=s,this.frameInterval=L[s].updateInterval),this.time+=.016*this.speed,this.updateExplosions(),this.updateMouseTrail(),this.updateIntensityTween(),this.render()};getPerformanceMetrics(){return this.lastMetrics}render(){if(this.isTransitioning){const e=Date.now()-this.transitionStartTime;this.transitionProgress=Math.min(e/this.transitionDuration,1),this.transitionProgress>=1&&(this.isTransitioning=!1,this.oldEffect=null)}this.ctx.fillStyle=this.backgroundColor,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height);const t=this.currentQuality==="low"?Math.max(this.fontSize,18):this.fontSize;this.buildCharAtlas(this.color,t),this.ctx.font=`${t}px monospace`,this.ctx.textBaseline="top",this.isTransitioning&&this.oldEffect?this.renderCrossfade():this.renderEffect(this.effect,1)}renderCrossfade(){if(!this.oldEffect)return;const t=this.easeInOutCubic(this.transitionProgress);this.renderEffect(this.oldEffect,1-t),this.renderEffect(this.effect,t)}easeInOutCubic(t){return t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2}renderEffect(t,e){const s=this.ctx.globalAlpha;switch(this.ctx.globalAlpha=e,t){case"matrix":this.renderMatrix();break;case"wave":this.renderWave();break;case"pulse":this.renderPulse();break;case"glitch":this.renderGlitch();break;default:this.renderWave()}this.ctx.globalAlpha=s}renderStatic(){this.ctx.fillStyle=this.backgroundColor,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.font=`${this.fontSize}px monospace`,this.ctx.textBaseline="top",this.ctx.fillStyle=this.color;for(let t=0;t<this.rows;t++)for(let e=0;e<this.cols;e++){const s=this.charSet[Math.floor(Math.random()*this.charSet.length)];this.ctx.fillText(s,e*this.cellWidth,t*this.cellHeight)}}renderMatrix(){for(let t=0;t<this.matrixColumns.length;t++){const e=this.matrixColumns[t],s=e.chars.length,n=s-1;for(let i=0;i<s;i++){const a=Math.floor(e.y)+i;if(a<0||a>=this.rows)continue;const h=i/s,r=i===n;let o;r?o=.95*this.intensity:o=h*.6*this.intensity;const d=t/this.cols,c=a/this.rows,f=Math.sqrt((d-this.mouseX)**2+(c-this.mouseY)**2),p=.15;if(f<p){const w=(1-f/p)*.4;o=Math.min(1,o+w*this.intensity)}const{x,y:u,alpha:l}=this.applyExplosionEffect(t,a,o);if(l<=.01)continue;const m=r?.08:.02;Math.random()<m&&(e.chars[i]=R.matrix[Math.floor(Math.random()*R.matrix.length)]),r?(this.ctx.fillStyle=`rgba(255, 255, 255, ${l})`,this.ctx.fillText(e.chars[i],x,u)):this.drawCharFromAtlas(e.chars[i],x,u,l,!0)}e.y+=e.speed*this.speed,e.y>this.rows+s&&(e.y=-s,e.speed=Math.random()*.5+.3)}this.ctx.globalAlpha=1}renderWave(){const t=this.currentQuality==="low"?2:1;for(let e=0;e<this.rows;e+=t)for(let s=0;s<this.cols;s+=t){const n=s/this.cols-this.mouseX,i=e/this.rows-this.mouseY,a=Math.sqrt(n*n+i*i),h=Math.sin(s*.1+this.time)*Math.cos(e*.1+this.time),r=this.currentQuality==="low"?0:Math.sin(a*10-this.time*2)*Math.exp(-a*3),o=(h+r+1)/2,d=Math.floor(o*(this.charSet.length-1)),c=this.charSet[Math.min(d,this.charSet.length-1)],f=(.2+o*.5)*this.intensity,{x:p,y:x,alpha:u}=this.applyExplosionEffect(s,e,f);u<=.01||this.drawCharFromAtlas(c,p,x,u)}this.ctx.globalAlpha=1}renderPulse(){const t=(Math.sin(this.time*2)+1)/2,e=this.currentQuality==="low"?2:1,s=this.cols/2,n=this.rows/2,i=Math.sqrt(s**2+n**2),a=this.mouseX*this.cols,h=this.mouseY*this.rows;for(let r=0;r<this.rows;r+=e)for(let o=0;o<this.cols;o+=e){const c=Math.sqrt((o-s)**2+(r-n)**2)/i;let p=(Math.sin(c*10-this.time*3)+1)/2*(1-c*.5)*(.5+t*.5);const u=Math.sqrt((o-a)**2+(r-h)**2)/(i*.5);if(u<1){const T=(Math.sin(u*8-this.time*4)+1)/2*(1-u)*.5;p=Math.max(p,T)}const l=Math.floor(p*(this.charSet.length-1)),m=this.charSet[Math.min(l,this.charSet.length-1)],w=p*.7*this.intensity,{x:C,y:M,alpha:v}=this.applyExplosionEffect(o,r,w);v<=.01||this.drawCharFromAtlas(m,C,M,v)}this.ctx.globalAlpha=1}updateMouseTrail(){const t=Date.now();(this.mouseTrail.length===0||Math.abs(this.mouseTrail[this.mouseTrail.length-1].x-this.mouseX)>.01||Math.abs(this.mouseTrail[this.mouseTrail.length-1].y-this.mouseY)>.01)&&this.mouseTrail.push({x:this.mouseX,y:this.mouseY,time:t}),this.mouseTrail=this.mouseTrail.filter(e=>t-e.time<1e3).slice(-15)}renderGlitch(){const t=this.hexToRgb(this.color),e=this.currentQuality==="low"?2:1,s=this.currentQuality==="low",n=this.time*.5,i=n*.3%1.4-.2,a=.08,r=!s&&Math.sin(n*.7)>.97?(Math.sin(n*50)+1)*.5:0,o=s?0:Date.now();for(let d=0;d<this.rows;d+=e){const c=d/this.rows,f=Math.abs(c-i)<a,p=f?1-Math.abs(c-i)/a:0,x=f&&!s?Math.sin(d*.5+this.time*10)*p*3:0;for(let u=0;u<this.cols;u+=e){const l=u/this.cols,m=Math.sin(u*.15+this.time*.5)*Math.cos(d*.12+this.time*.3),w=s?(m+1)/2:(m+Math.sin((u+d)*.08+this.time*.2)+2)/4,C=Math.floor(w*(this.charSet.length-1)),M=this.charSet[Math.max(0,Math.min(C,this.charSet.length-1))];let v=(.15+w*.25)*this.intensity;f&&(v+=p*.4*this.intensity),r>0&&Math.random()<r*.3&&(v=Math.min(1,v+r*.5));const{x:b,y:T,alpha:A}=this.applyExplosionEffect(u,d,v);if(A<=.01)continue;let S=t.r,E=t.g,I=t.b;if(f&&!s){const P=p*20;S=Math.min(255,t.r+P),I=Math.max(0,t.b-P)}let D=!1,_=0;if(!s){const P=Math.sqrt((l-this.mouseX)**2+(c-this.mouseY)**2),F=.08;P<F&&(D=!0,_=(1-P/F)*.6);for(const k of this.mouseTrail){const U=Math.sqrt((l-k.x)**2+(c-k.y)**2),Q=(o-k.time)/1500,Y=F*(1-Q*.5);if(U<Y){const X=(1-U/Y)*(1-Q);X>.3&&(D=!0),_=Math.max(_,X*.4)}}}D&&(S=255-S,E=255-E,I=255-I);const Z=Math.min(1,A+_);this.ctx.fillStyle=`rgba(${S}, ${E}, ${I}, ${Z})`;const J=b+x*this.cellWidth,K=T;this.ctx.fillText(M,J,K)}}}setEffect(t){t!==this.effect&&(this.oldEffect=this.effect,this.effect=t,this.isTransitioning=!0,this.transitionProgress=0,this.transitionStartTime=Date.now(),t==="matrix"&&this.initMatrixColumns())}setColor(t){this.color=t}setSpeed(t){this.speed=Math.max(.25,Math.min(3,t))}setIntensity(t){this.intensity=Math.max(.1,Math.min(1,t)),this.targetIntensity=this.intensity}setIntensityAnimated(t,e=500){const s=Math.max(.1,Math.min(1,t));s!==this.intensity&&(this.intensityTweenStart=this.intensity,this.targetIntensity=s,this.intensityTweenDuration=e,this.intensityTweenProgress=0,this.intensityTweenStartTime=performance.now())}updateIntensityTween(){if(this.intensityTweenProgress>=1)return;const t=performance.now()-this.intensityTweenStartTime;this.intensityTweenProgress=Math.min(1,t/this.intensityTweenDuration);const e=1-Math.pow(1-this.intensityTweenProgress,3);this.intensity=this.intensityTweenStart+(this.targetIntensity-this.intensityTweenStart)*e}setFontSize(t){this.fontSize=Math.max(10,Math.min(20,t)),this.cellWidth=this.fontSize*.6,this.cellHeight=this.fontSize,this.resize()}hexToRgb(t){const e={r:16,g:185,b:129};if(!t||t.length<4)return e;const s=t.replace("#",""),n=s.length===3?s.split("").map(a=>a+a).join(""):s,i=/^([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);return i?{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}:e}destroy(){this.stop(),window.removeEventListener("resize",this.handleResize),document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("visibilitychange",this.handleVisibilityChange),this.canvas.remove()}}const st=`#version 300 es
precision highp float;

in vec2 a_position;
in vec2 a_texCoord;
in float a_charIndex;
in float a_alpha;

uniform vec2 u_resolution;
uniform vec2 u_cellSize;
uniform float u_atlasWidth;
uniform float u_charWidth;

out vec2 v_texCoord;
out float v_alpha;

void main() {
  // Calculate character position in atlas
  float charU = a_charIndex * u_charWidth / u_atlasWidth;

  // Map texCoord to the character in atlas
  v_texCoord = vec2(charU + a_texCoord.x * u_charWidth / u_atlasWidth, a_texCoord.y);
  v_alpha = a_alpha;

  // Convert pixel position to clip space
  vec2 clipSpace = (a_position / u_resolution) * 2.0 - 1.0;
  gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);
}
`,it=`#version 300 es
precision highp float;

in vec2 v_texCoord;
in float v_alpha;

uniform sampler2D u_atlas;
uniform vec3 u_color;

out vec4 fragColor;

void main() {
  vec4 texColor = texture(u_atlas, v_texCoord);
  // Use the texture alpha, tinted with uniform color
  fragColor = vec4(u_color, texColor.a * v_alpha);
}
`;class nt{container;canvas;gl;program;charSet;fontSize;cellWidth;cellHeight;cols;rows;color;backgroundColor;effect;speed;intensity;time=0;animationId=null;performanceMonitor;mouseX=0;mouseY=0;isRunning=!1;lastFrameTime=0;frameInterval=33;currentQuality="medium";lastMetrics={fps:0,frameTime:0,quality:"medium"};atlasTexture=null;positionBuffer=null;texCoordBuffer=null;charIndexBuffer=null;alphaBuffer=null;vao=null;uniforms={resolution:null,cellSize:null,atlasWidth:null,charWidth:null,atlas:null,color:null};attributes={position:-1,texCoord:-1,charIndex:-1,alpha:-1};atlasWidth=0;atlasCharWidth=0;atlasChars="";targetIntensity=.6;intensityTweenStart=.6;intensityTweenProgress=1;intensityTweenDuration=500;intensityTweenStartTime=0;matrixColumns=[];introActive=!0;introStartTime=0;introDuration=1e3;introColumnDelays=[];lastMouseUpdate=0;mouseThrottleInterval=33;isTransitioning=!1;transitionProgress=0;transitionDuration=800;oldEffect=null;transitionStartTime=0;constructor(t){this.container=t.container,this.charSet=R[t.charSet||"standard"],this.fontSize=t.fontSize||14,this.color=t.color||"#00ff00",this.backgroundColor=t.backgroundColor||"#0a0a0a",this.effect=t.effect||"wave",this.speed=t.speed||1,this.intensity=t.intensity||.6,this.performanceMonitor=new V,this.currentQuality=j(),this.frameInterval=L[this.currentQuality].updateInterval,this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.style.top="0",this.canvas.style.left="0",this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.zIndex="-1",this.container.appendChild(this.canvas);const e=this.canvas.getContext("webgl2",{alpha:!0,antialias:!1,premultipliedAlpha:!0});if(!e)throw new Error("WebGL2 not supported");this.gl=e,this.program=this.createProgram(),this.getLocations(),this.createBuffers(),this.createAtlasTexture(),this.cellWidth=this.fontSize*.6,this.cellHeight=this.fontSize,this.cols=0,this.rows=0,this.resize(),this.setupEventListeners()}createShader(t,e){const s=this.gl.createShader(t);if(!s)throw new Error("Failed to create shader");if(this.gl.shaderSource(s,e),this.gl.compileShader(s),!this.gl.getShaderParameter(s,this.gl.COMPILE_STATUS)){const n=this.gl.getShaderInfoLog(s);throw this.gl.deleteShader(s),new Error("Shader compile error: "+n)}return s}createProgram(){const t=this.createShader(this.gl.VERTEX_SHADER,st),e=this.createShader(this.gl.FRAGMENT_SHADER,it),s=this.gl.createProgram();if(!s)throw new Error("Failed to create program");if(this.gl.attachShader(s,t),this.gl.attachShader(s,e),this.gl.linkProgram(s),!this.gl.getProgramParameter(s,this.gl.LINK_STATUS)){const n=this.gl.getProgramInfoLog(s);throw new Error("Program link error: "+n)}return s}getLocations(){this.uniforms.resolution=this.gl.getUniformLocation(this.program,"u_resolution"),this.uniforms.cellSize=this.gl.getUniformLocation(this.program,"u_cellSize"),this.uniforms.atlasWidth=this.gl.getUniformLocation(this.program,"u_atlasWidth"),this.uniforms.charWidth=this.gl.getUniformLocation(this.program,"u_charWidth"),this.uniforms.atlas=this.gl.getUniformLocation(this.program,"u_atlas"),this.uniforms.color=this.gl.getUniformLocation(this.program,"u_color"),this.attributes.position=this.gl.getAttribLocation(this.program,"a_position"),this.attributes.texCoord=this.gl.getAttribLocation(this.program,"a_texCoord"),this.attributes.charIndex=this.gl.getAttribLocation(this.program,"a_charIndex"),this.attributes.alpha=this.gl.getAttribLocation(this.program,"a_alpha")}createBuffers(){this.vao=this.gl.createVertexArray(),this.gl.bindVertexArray(this.vao),this.positionBuffer=this.gl.createBuffer(),this.texCoordBuffer=this.gl.createBuffer(),this.charIndexBuffer=this.gl.createBuffer(),this.alphaBuffer=this.gl.createBuffer(),this.gl.bindVertexArray(null)}createAtlasTexture(){const t=R.matrix,e=this.charSet+t.split("").filter(a=>!this.charSet.includes(a)).join("");this.atlasChars=e;const s=e.length;this.atlasCharWidth=Math.ceil(this.fontSize*.6),this.atlasWidth=s*this.atlasCharWidth;const n=document.createElement("canvas");n.width=this.atlasWidth,n.height=this.fontSize;const i=n.getContext("2d");if(!i)throw new Error("Failed to get 2D context for atlas");i.font=`${this.fontSize}px monospace`,i.textBaseline="top",i.fillStyle="white";for(let a=0;a<s;a++)i.fillText(e[a],a*this.atlasCharWidth,0);this.atlasTexture=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this.atlasTexture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,n),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE)}setupEventListeners(){window.addEventListener("resize",this.handleResize),document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("visibilitychange",this.handleVisibilityChange)}handleResize=()=>{this.resize()};handleMouseMove=t=>{const e=performance.now();if(e-this.lastMouseUpdate<this.mouseThrottleInterval)return;this.lastMouseUpdate=e;const s=this.canvas.getBoundingClientRect();this.mouseX=(t.clientX-s.left)/s.width,this.mouseY=(t.clientY-s.top)/s.height};handleVisibilityChange=()=>{$()&&this.isRunning?this.start():this.pause()};resize(){const t=this.container.getBoundingClientRect(),e=window.devicePixelRatio||1;this.canvas.width=t.width*e,this.canvas.height=t.height*e,this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.cols=Math.floor(t.width/this.cellWidth),this.rows=Math.floor(t.height/this.cellHeight),this.initIntroDelays(),this.initMatrixColumns()}initIntroDelays(){this.introColumnDelays=[];for(let t=0;t<this.cols;t++){const e=this.cols/2,s=Math.abs(t-e)/e;this.introColumnDelays[t]=s*.4+Math.random()*.3}}initMatrixColumns(){this.matrixColumns=[];for(let t=0;t<this.cols;t++)this.matrixColumns.push({y:Math.random()*this.rows*-1,speed:Math.random()*.5+.3,chars:this.generateRandomChars(Math.floor(Math.random()*15)+5)})}generateRandomChars(t){const e=[],s=R.matrix;for(let n=0;n<t;n++)e.push(s[Math.floor(Math.random()*s.length)]);return e}getIntroAlpha(t,e){if(!this.introActive)return 1;const n=performance.now()-this.introStartTime,i=Math.min(n/this.introDuration,1);if(i>=1)return this.introActive=!1,1;const h=(this.introColumnDelays[t]||0)*.5,r=Math.max(0,(i-h)/(1-h));if(r<=0)return 0;const o=e/this.rows,d=r*1.3,c=o-d;if(c>.2)return 0;if(c>0){const f=1-c/.2;return f*f*(3-2*f)}else return 1}start(){this.isRunning=!0,this.introActive=!0,this.introStartTime=performance.now(),this.animate()}skipIntro(){this.introActive=!1}pause(){this.animationId!==null&&(cancelAnimationFrame(this.animationId),this.animationId=null)}stop(){this.isRunning=!1,this.pause()}animate=()=>{if(!this.isRunning)return;this.animationId=requestAnimationFrame(this.animate);const t=performance.now(),e=t-this.lastFrameTime;if(e<this.frameInterval)return;this.lastFrameTime=t-e%this.frameInterval,this.lastMetrics=this.performanceMonitor.tick();const s=this.performanceMonitor.checkAndAdapt();s!==this.currentQuality&&(this.currentQuality=s,this.frameInterval=L[s].updateInterval),this.time+=.016*this.speed,this.updateIntensityTween(),this.render()};getPerformanceMetrics(){return this.lastMetrics}render(){const t=this.gl,e=this.hexToRgb(this.color),s=this.hexToRgb(this.backgroundColor);if(this.isTransitioning){const n=Date.now()-this.transitionStartTime;this.transitionProgress=Math.min(n/this.transitionDuration,1),this.transitionProgress>=1&&(this.isTransitioning=!1,this.oldEffect=null)}if(t.clearColor(s.r/255,s.g/255,s.b/255,1),t.clear(t.COLOR_BUFFER_BIT),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.useProgram(this.program),t.uniform2f(this.uniforms.resolution,this.canvas.width,this.canvas.height),t.uniform2f(this.uniforms.cellSize,this.cellWidth,this.cellHeight),t.uniform1f(this.uniforms.atlasWidth,this.atlasWidth),t.uniform1f(this.uniforms.charWidth,this.atlasCharWidth),t.uniform3f(this.uniforms.color,e.r/255,e.g/255,e.b/255),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.atlasTexture),t.uniform1i(this.uniforms.atlas,0),this.isTransitioning&&this.oldEffect){const n=this.easeInOutCubic(this.transitionProgress);this.renderEffect(this.oldEffect,1-n),this.renderEffect(this.effect,n)}else this.renderEffect(this.effect,1)}easeInOutCubic(t){return t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2}renderEffect(t,e){switch(t){case"wave":this.renderWave(e);break;case"pulse":this.renderPulse(e);break;case"matrix":this.renderMatrix(e);break;case"glitch":this.renderGlitch(e);break;default:this.renderWave(e)}}renderWave(t=1){const e=[],s=[],n=[],i=[],a=this.currentQuality==="low"?2:1,h=window.devicePixelRatio||1;for(let r=0;r<this.rows;r+=a)for(let o=0;o<this.cols;o+=a){const d=o/this.cols-this.mouseX,c=r/this.rows-this.mouseY,f=Math.sqrt(d*d+c*c),p=Math.sin(o*.1+this.time)*Math.cos(r*.1+this.time),x=this.currentQuality==="low"?0:Math.sin(f*10-this.time*2)*Math.exp(-f*3),u=(p+x+1)/2,l=Math.floor(u*(this.charSet.length-1));let m=(.2+u*.5)*this.intensity*t;if(m*=this.getIntroAlpha(o,r),m<=.01)continue;const w=o*this.cellWidth*h,C=r*this.cellHeight*h,M=this.cellWidth*h,v=this.cellHeight*h;e.push(w,C,w+M,C,w,C+v),e.push(w+M,C,w+M,C+v,w,C+v),s.push(0,0,1,0,0,1,1,0,1,1,0,1);for(let b=0;b<6;b++)n.push(l),i.push(m)}this.uploadAndDraw(e,s,n,i)}renderPulse(t=1){const e=[],s=[],n=[],i=[],a=this.currentQuality==="low"?2:1,h=window.devicePixelRatio||1,r=(Math.sin(this.time*2)+1)/2,o=this.cols/2,d=this.rows/2,c=Math.sqrt(o**2+d**2),f=this.mouseX*this.cols,p=this.mouseY*this.rows;for(let x=0;x<this.rows;x+=a)for(let u=0;u<this.cols;u+=a){const m=Math.sqrt((u-o)**2+(x-d)**2)/c;let C=(Math.sin(m*10-this.time*3)+1)/2*(1-m*.5)*(.5+r*.5);const v=Math.sqrt((u-f)**2+(x-p)**2)/(c*.5);if(v<1){const _=(Math.sin(v*8-this.time*4)+1)/2*(1-v)*.5;C=Math.max(C,_)}const b=Math.floor(C*(this.charSet.length-1));let T=C*.7*this.intensity*t;if(T*=this.getIntroAlpha(u,x),T<=.01)continue;const A=u*this.cellWidth*h,S=x*this.cellHeight*h,E=this.cellWidth*h,I=this.cellHeight*h;e.push(A,S,A+E,S,A,S+I),e.push(A+E,S,A+E,S+I,A,S+I),s.push(0,0,1,0,0,1,1,0,1,1,0,1);for(let D=0;D<6;D++)n.push(b),i.push(T)}this.uploadAndDraw(e,s,n,i)}renderMatrix(t=1){const e=[],s=[],n=[],i=[],a=window.devicePixelRatio||1;for(let h=0;h<this.matrixColumns.length;h++){const r=this.matrixColumns[h],o=r.chars.length,d=o-1;for(let c=0;c<o;c++){const f=Math.floor(r.y)+c;if(f<0||f>=this.rows)continue;const p=c/o,x=c===d;let u=x?.95*this.intensity:p*.6*this.intensity;const l=h/this.cols,m=f/this.rows,w=Math.sqrt((l-this.mouseX)**2+(m-this.mouseY)**2),C=.15;if(w<C){const E=(1-w/C)*.4;u=Math.min(1,u+E*this.intensity)}if(u*=this.getIntroAlpha(h,f)*t,u<=.01)continue;const M=x?.08:.02;Math.random()<M&&(r.chars[c]=R.matrix[Math.floor(Math.random()*R.matrix.length)]);const v=this.atlasChars.indexOf(r.chars[c]);if(v===-1)continue;const b=h*this.cellWidth*a,T=f*this.cellHeight*a,A=this.cellWidth*a,S=this.cellHeight*a;e.push(b,T,b+A,T,b,T+S),e.push(b+A,T,b+A,T+S,b,T+S),s.push(0,0,1,0,0,1,1,0,1,1,0,1);for(let E=0;E<6;E++)n.push(v),i.push(u)}r.y+=r.speed*this.speed,r.y>this.rows+o&&(r.y=-o,r.speed=Math.random()*.5+.3)}this.uploadAndDraw(e,s,n,i)}renderGlitch(t=1){const e=[],s=[],n=[],i=[],a=this.currentQuality==="low"?2:1,h=window.devicePixelRatio||1,o=this.time*.5*.3%1.4-.2,d=.08;for(let c=0;c<this.rows;c+=a){const f=c/this.rows,p=Math.abs(f-o)<d,x=p?1-Math.abs(f-o)/d:0;for(let u=0;u<this.cols;u+=a){const l=u/this.cols,w=(Math.sin(u*.15+this.time*.5)*Math.cos(c*.12+this.time*.3)+1)/2,C=Math.floor(w*(this.charSet.length-1));let M=(.15+w*.25)*this.intensity;p&&(M+=x*.4*this.intensity);const v=Math.sqrt((l-this.mouseX)**2+(f-this.mouseY)**2),b=.12;if(v<b){const I=(1-v/b)*.5;M=Math.min(1,M+I*this.intensity)}if(M*=this.getIntroAlpha(u,c)*t,M<=.01)continue;const T=u*this.cellWidth*h,A=c*this.cellHeight*h,S=this.cellWidth*h,E=this.cellHeight*h;e.push(T,A,T+S,A,T,A+E),e.push(T+S,A,T+S,A+E,T,A+E),s.push(0,0,1,0,0,1,1,0,1,1,0,1);for(let I=0;I<6;I++)n.push(C),i.push(Math.min(1,M))}}this.uploadAndDraw(e,s,n,i)}uploadAndDraw(t,e,s,n){const i=this.gl;t.length!==0&&(i.bindVertexArray(this.vao),i.bindBuffer(i.ARRAY_BUFFER,this.positionBuffer),i.bufferData(i.ARRAY_BUFFER,new Float32Array(t),i.DYNAMIC_DRAW),i.enableVertexAttribArray(this.attributes.position),i.vertexAttribPointer(this.attributes.position,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,this.texCoordBuffer),i.bufferData(i.ARRAY_BUFFER,new Float32Array(e),i.DYNAMIC_DRAW),i.enableVertexAttribArray(this.attributes.texCoord),i.vertexAttribPointer(this.attributes.texCoord,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,this.charIndexBuffer),i.bufferData(i.ARRAY_BUFFER,new Float32Array(s),i.DYNAMIC_DRAW),i.enableVertexAttribArray(this.attributes.charIndex),i.vertexAttribPointer(this.attributes.charIndex,1,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,this.alphaBuffer),i.bufferData(i.ARRAY_BUFFER,new Float32Array(n),i.DYNAMIC_DRAW),i.enableVertexAttribArray(this.attributes.alpha),i.vertexAttribPointer(this.attributes.alpha,1,i.FLOAT,!1,0,0),i.drawArrays(i.TRIANGLES,0,t.length/2),i.bindVertexArray(null))}updateIntensityTween(){if(this.intensityTweenProgress>=1)return;const t=performance.now()-this.intensityTweenStartTime;this.intensityTweenProgress=Math.min(1,t/this.intensityTweenDuration);const e=1-Math.pow(1-this.intensityTweenProgress,3);this.intensity=this.intensityTweenStart+(this.targetIntensity-this.intensityTweenStart)*e}setEffect(t){t!==this.effect&&(this.oldEffect=this.effect,this.effect=t,this.isTransitioning=!0,this.transitionProgress=0,this.transitionStartTime=Date.now(),t==="matrix"&&this.initMatrixColumns())}setColor(t){this.color=t}setSpeed(t){this.speed=Math.max(.25,Math.min(3,t))}setIntensity(t){this.intensity=Math.max(.1,Math.min(1,t)),this.targetIntensity=this.intensity}setIntensityAnimated(t,e=500){const s=Math.max(.1,Math.min(1,t));s!==this.intensity&&(this.intensityTweenStart=this.intensity,this.targetIntensity=s,this.intensityTweenDuration=e,this.intensityTweenProgress=0,this.intensityTweenStartTime=performance.now())}setFontSize(t){this.fontSize=Math.max(10,Math.min(20,t)),this.cellWidth=this.fontSize*.6,this.cellHeight=this.fontSize,this.createAtlasTexture(),this.resize()}triggerExplosion(t,e){console.log("Explosion effect not implemented in WebGL version.",{x:t,y:e})}renderStaticFrame(){this.render()}hexToRgb(t){const e={r:16,g:185,b:129};if(!t||t.length<4)return e;const s=t.replace("#",""),n=s.length===3?s.split("").map(a=>a+a).join(""):s,i=/^([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);return i?{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}:e}destroy(){this.stop(),window.removeEventListener("resize",this.handleResize),document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("visibilitychange",this.handleVisibilityChange),this.gl.deleteTexture(this.atlasTexture),this.gl.deleteBuffer(this.positionBuffer),this.gl.deleteBuffer(this.texCoordBuffer),this.gl.deleteBuffer(this.charIndexBuffer),this.gl.deleteBuffer(this.alphaBuffer),this.gl.deleteVertexArray(this.vao),this.gl.deleteProgram(this.program),this.canvas.remove()}}function rt(){try{return!!document.createElement("canvas").getContext("webgl2")}catch{return!1}}const at=.8,ot=.5,G=.25,B=600;function ht(y){const t=g.useCallback(s=>{const n=window.matchMedia(y);return n.addEventListener("change",s),()=>n.removeEventListener("change",s)},[y]),e=g.useCallback(()=>window.matchMedia(y).matches,[y]);return g.useSyncExternalStore(t,e)}function lt(){const y=g.useCallback(e=>(document.addEventListener("astro:after-swap",e),window.addEventListener("popstate",e),()=>{document.removeEventListener("astro:after-swap",e),window.removeEventListener("popstate",e)}),[]),t=g.useCallback(()=>{const e=window.location.pathname;return e==="/"||e===""},[]);return g.useSyncExternalStore(y,t)}function H(y,t,e="window"){const s=g.useRef(t);s.current=t,g.useEffect(()=>{const n=e==="document"?document:window,i=a=>s.current(a);return n.addEventListener(y,i),()=>n.removeEventListener(y,i)},[y,e])}function z(y,t){const e=g.useCallback(s=>t(s.detail),[t]);H(y,e)}function ct(y,t,e,s){const n=g.useRef(null),i=g.useRef(rt()),a=g.useMemo(()=>t?G:e?at:ot,[t,e]),h=g.useCallback(()=>{const r=y.current;if(!r)return;n.current?.destroy(),n.current=null;const o=q(),d={container:r,effect:o.effect||s,fontSize:/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)?16:14,speed:t?.3:o.speed||1,intensity:a,color:(O[o.colorTheme]||O.green).primary,backgroundColor:getComputedStyle(document.documentElement).getPropertyValue("--bg-primary").trim()||"#0f0f0f"};try{n.current=i.current?new nt(d):new N(d),t?(r.style.opacity="0.3",n.current.renderStaticFrame()):n.current.start()}catch(c){if(console.error("Renderer init failed:",c),i.current){i.current=!1;try{n.current=new N(d),t?n.current.renderStaticFrame():n.current.start()}catch(f){console.error("Fallback failed:",f)}}}},[y,s,t,a]);return g.useEffect(()=>()=>{n.current?.destroy(),n.current=null},[]),{rendererRef:n,init:h,intensity:a}}function ut({effect:y="wave"}){const t=g.useRef(null),e=ht("(prefers-reduced-motion: reduce)"),s=lt(),[n,i]=g.useState(!1),[a,h]=g.useState(null),{rendererRef:r,init:o,intensity:d}=ct(t,e,s,y);g.useEffect(()=>{o()},[o]),g.useEffect(()=>{const l=q();i(!!l.showFps)},[]),g.useEffect(()=>{const l=()=>{const m=document.querySelector(".navigation"),w=m?m.getBoundingClientRect().height:0;document.documentElement.style.setProperty("--ascii-fps-offset",`${w}px`)};return l(),window.addEventListener("resize",l),document.addEventListener("astro:after-swap",l),()=>{window.removeEventListener("resize",l),document.removeEventListener("astro:after-swap",l)}},[]),g.useEffect(()=>{const l=r.current,m=t.current;l&&(e?(l.setSpeed(.3),l.setIntensityAnimated(G,B),m&&(m.style.opacity="0.3")):(l.setSpeed(1),l.setIntensityAnimated(d,B),m&&(m.style.opacity="")))},[e,d,r]),g.useEffect(()=>{const l=r.current;l&&!e&&l.setIntensityAnimated(d,B)},[s,d,e,r]);const c=g.useCallback(l=>{const m=r.current;typeof l.showFps=="boolean"&&i(l.showFps),m&&(m.setEffect(l.effect),m.setSpeed(l.speed),m.setIntensity(l.intensity),m.setColor(l.color))},[r]),f=g.useCallback(l=>{r.current?.setEffect(l)},[r]),p=g.useCallback(l=>{r.current?.triggerExplosion(l.x,l.y)},[r]),x=g.useCallback(()=>{r.current?.destroy(),r.current=null},[r]),u=g.useCallback(()=>{!r.current&&!e&&o()},[r,e,o]);return z("ascii-settings-change",c),z("ascii-effect-change",f),z("ascii-trigger-explosion",p),H("astro:before-swap",x,"document"),H("astro:after-swap",u,"document"),g.useEffect(()=>{if(!n){h(null);return}const l=window.setInterval(()=>{const m=r.current;if(!m)return;const w=m.getPerformanceMetrics?.();w&&h(w.fps)},500);return()=>window.clearInterval(l)},[n,r]),W.jsx("div",{ref:t,id:"ascii-background",className:"ascii-background",role:"img","aria-label":"Animated ASCII art background","aria-hidden":!0,"data-effect":y,children:n&&W.jsx("div",{className:"ascii-fps","aria-hidden":"true",children:a?`${a} fps`:"..."})})}class ft extends g.Component{constructor(t){super(t),this.state={hasError:!1}}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(t,e){console.error("ASCII Background error:",t,e)}render(){return this.state.hasError?this.props.fallback??W.jsx("div",{className:"ascii-background",style:{position:"fixed",inset:0,backgroundColor:"var(--bg-primary, #0f0f0f)",zIndex:-1},"aria-hidden":!0}):this.props.children}}function gt({effect:y="wave"}){return W.jsx(ft,{children:W.jsx(ut,{effect:y})})}export{gt as default};
