---
import BaseLayout from './BaseLayout.astro';
import Navigation from '@/components/ui/Navigation.astro';
import ASCIIBackground from '@/components/ascii/ASCIIBackground.astro';

interface Props {
  title: string;
  description?: string;
  backHref?: string;
  backLabel?: string;
}

const { title, description, backHref = '/', backLabel = 'Back to home' } = Astro.props;
---

<BaseLayout title={title} description={description}>
  <ASCIIBackground />

  <div class="page-layout">
    <Navigation />

    <main id="main-content" class="main-content">
      <div class="content-wrapper" transition:animate="fade">
        <slot />
      </div>
    </main>
  </div>
</BaseLayout>

<style>
  .page-layout {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }

  .main-content {
    flex: 1;
    display: flex;
    justify-content: center;
    padding: var(--space-lg) var(--space-md);
  }

  .content-wrapper {
    width: 100%;
    max-width: var(--container-max);
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius);
    padding: var(--space-lg);
    box-shadow: var(--shadow-md);
    position: relative;
  }

  .content-back-button {
    position: absolute;
    top: var(--space-sm);
    right: var(--space-sm);
    width: 2.25rem;
    height: 2.25rem;
    display: grid;
    place-items: center;
    font-family: var(--font-mono);
    font-size: 0.75rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--text-primary);
    background: color-mix(in srgb, var(--bg-primary) 80%, transparent);
    border: 1px solid var(--border-color);
    border-radius: 6px;
    text-decoration: none;
    box-shadow: var(--shadow-sm);
    transition: background var(--transition-fast), color var(--transition-fast), border-color var(--transition-fast);
  }

  .content-back-button:hover,
  .content-back-button:focus-visible {
    background: var(--ascii-tint);
    border-color: var(--border-hover);
    color: var(--color-primary);
  }

  :global([data-astro-transition="fade"]) {
    animation: page-zoom-in 0.5s cubic-bezier(0.16, 1, 0.3, 1) both;
  }

  @keyframes page-zoom-in {
    0% {
      transform: scale(0.88);
      opacity: 0;
    }
    100% {
      transform: scale(1);
      opacity: 1;
    }
  }

  @media (max-width: 768px) {
    .main-content {
      padding: var(--space-md) var(--space-sm);
    }

    .content-wrapper {
      padding: var(--space-md);
      border-radius: var(--border-radius-sm);
    }

    .content-back-button {
      top: var(--space-xs);
      right: var(--space-xs);
      width: 2rem;
      height: 2rem;
      font-size: 0.7rem;
    }
  }

  @media (max-width: 480px) {
    .content-wrapper {
      border-left: none;
      border-right: none;
      border-radius: 0;
    }
  }
</style>

<script>
  function triggerPageExplosion() {
    setTimeout(() => {
      window.dispatchEvent(new CustomEvent('ascii-trigger-explosion', {
        detail: { x: 0.5, y: 0.4 }
      }));
    }, 100);
  }

  // Run on initial load
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', triggerPageExplosion);
  } else {
    triggerPageExplosion();
  }

  // Run on view transitions
  document.addEventListener('astro:after-swap', triggerPageExplosion);
</script>
